// mino controller v1.0 by jon james (github.com/jonjamz)

function loadInputs(){$("input").each(function(){var a=$(this).attr("type");$(this).addClass(a)})}function onLoadFades(){$(".onLoadFade").each(function(){$(this).delay(2e3).fadeOut(1e3)})}function loadIncludes(){$(".include").each(function(){var a="random-"+Math.floor(Math.random()*1e5);$(this).addClass(a);$(this).removeClass("include");var b="."+a;var c=$(this).attr("data-view");$.get("routers/view.router.php",{view:c},function(a){var c=a;$(b).load(c,function(){onLoads();onLoadFades();loadIncludes();loadInputs()})})})}function onLoads(){$(".onLoad").each(function(){var a="random-"+Math.floor(Math.random()*1e5);$(this).addClass(a);var b="."+a;var c=$(this).attr("data-model");var d=$(this).attr("data-method");var e=$(this).attr("data-send");models(c,d,e,b);$(this).removeClass(".onLoad")})}function models(a,b,c,d){$.ajax({type:"POST",url:"routers/model.router.php",data:"type=default&method="+b+"&args="+c+"&model="+a,success:function(a){if(a.indexOf("!redirect")>-1){var b=a;b=b.replace(/!redirect\s*/,"");window.location.href=b}else if(a.indexOf("!push")>-1){var b=a;b=b.replace(/!push\s*/,"");History.pushState({state:b},b,b)}else if(a.indexOf("!append")>-1){var c=a;c=c.replace(/!append\s*/,"");if($(d+" .response").is("*")){$(d+" .response").html(c)}else{$(d).append('<div class="response">'+c+"</div>")}}else{$(d).html(a)}}})}function implode(a,b){var c="",d="",e="";if(arguments.length===1){b=a;a=""}if(typeof b==="object"){if(Object.prototype.toString.call(b)==="[object Array]"){return b.join(a)}for(c in b){d+=e+b[c];e=a}return d}return b}$("#view-load").on("submit","form.dbForm",function(){var a="random-"+Math.floor(Math.random()*1e5);$(this).addClass(a);var b="."+a;var c=$(this).attr("data-model");var d=$(this).attr("data-method");var e=$(this).serializeJSON();var f=implode(",",e);models(c,d,f,b);$("input[type=submit]",this).attr("disabled","disabled");return false});$("body").on("click",".onClick",function(){var a=$(this).attr("data-model");var b=$(this).attr("data-method");var c=$(this).attr("data-send");var d=$(this).attr("data-to");if(d==="this"||d===""){d="random-"+Math.floor(Math.random()*1e5);$(this).addClass(rndm)}models(a,b,c,d);return false});var dbl=0;$("body").on("click",".loadView",function(){var a=$(this).attr("data-view");var b="";$.get("routers/view.router.php",{view:a},function(a){if(a.indexOf("!logout")>-1){window.location.href="index.php?url=logout"}else{var b=a;$("#view-load").load(b,function(){onLoads();onLoadFades();loadIncludes();loadInputs()})}});dbl=1;History.pushState({state:a},a,a);dbl=0;$(".selected").removeClass("selected");$(this).addClass("selected");return false});$("body").on("click",".loadSubView",function(){var a=$(this).attr("data-view");var b=$(this).attr("data-to");var c="";$.get("routers/view.router.php",{view:a},function(a){if(a.indexOf("!logout")>-1){window.location.href="index.php?url=logout"}else{var c=a;$(b).load(c,function(){onLoads();onLoadFades();loadIncludes();loadInputs()})}});dbl=1;History.pushState({state:a},a,a);dbl=0;$(".selected").removeClass("selected");$(this).addClass("selected");return false})
function routeUrl() { var view  = '<?php echo $view; ?>'; $.get("routers/view.router.php", { view: view }, function(data){ var viewDir = data; $('#view-load').load(viewDir, function() { $('[value="urlArg"]').attr('value', '<?php echo $urlArg; ?>'); $('[data-send="urlArg"]').attr('data-send', '<?php echo $urlArg; ?>'); <?php foreach($urlArgs as $key => $val) { ?> $('[value="^<?php echo $key; ?>"]').attr('value', '<?php echo $val; ?>'); $('[data-send="^<?php echo $key; ?>"]').attr('data-send', '<?php echo $val; ?>'); <?php } ?> $('[value="urlArgs"]').attr('value', '<?php echo implode(",", $urlArgs); ?>'); $('[data-send="urlArgs"]').attr('data-send', '<?php echo implode(",", $urlArgs); ?>'); <?php foreach($urlArgs as $key => $val) { if(is_int($key)) { $urlArgsNumeric[] = $val; } } ?> <?php foreach($urlArgs as $key => $val) { if(!is_int($key)) { $urlArgsAlpha[] = $val; } } ?> $('[value="urlArgs"]').attr('value', '<?php echo implode(",", $urlArgs); ?>'); $('[data-send="urlArgs"]').attr('data-send', '<?php echo implode(",", $urlArgs); ?>'); $('[value="urlArgsN"]').attr('value', '<?php echo implode(",", $urlArgsNumeric); ?>'); $('[data-send="urlArgsN"]').attr('data-send', '<?php echo implode(",", $urlArgsNumeric); ?>'); $('[value="urlArgsA"]').attr('value', '<?php echo implode(",", $urlArgsAlpha); ?>'); $('[data-send="urlArgsA"]').attr('data-send', '<?php echo implode(",", $urlArgsAlpha); ?>'); onLoads(); onLoadFades(); loadIncludes(); loadInputs(); }); }); dbl = 1; History.pushState({state: view}, view, view); dbl = 0; } routeUrl();
function routeState(a){$.get("routers/view.router.php",{view:a},function(a){var b=a;$("#view-load").load(b,function(){onLoads();onLoadFades();loadIncludes();loadInputs()})})}var goState=function(){if(dbl===0){var a=History.getState();routeState(a.title)}};History.Adapter.bind(window,"statechange",goState)
