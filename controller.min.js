// mino controller v1.0 by jon james (github.com/jonjamz)
function routeState(a){$.get(MINOC("B2")+MINOC("B9"),{url:a},function(a){var b=a.view;var c=a.title;var d=a.vars;var e=implode(",",d);var f="#view-load";if(b.indexOf("!logout")>-1){window.location.href=MINOC("B2")+"/"}else{viewLoad(b,d,e,f)}},"json")}function routeUrl(){var a="!init";$.get(MINOC("B2")+MINOC("B9"),{url:a+MINOC("B1")},function(a){var b=a.view;var c=a.title;var d=a.address;var e=a.vars;var f=a.flag;var g=implode(",",e);var h="#view-load";if(f===2){window.location.href=MINOC("B2")+"/"}else if(f===1){viewLoad(b,e,g,h);document.title=c;dbl=1;History.pushState({state:MINOC("B1")},c);dbl=0}else{viewLoad(b,e,g,h);dbl=1;History.pushState({state:MINOC("B1")},c,d);dbl=0}},"json")}function viewLoad(a,b,c,d){var a=MINOC("B2")+"/"+a;$(d).fadeOut(100,function(){$(this).load(a,function(){$.each(b,function(a,b){$('[value~="^'+a+'"]').attr("value",b);$('[data-send~="^'+a+'"]').attr("data-send",b)});$('[value~="urlArgs"]').attr("value",c);$('[data-send~="urlArgs"]').attr("data-send",c);onLoads();onLoadFades();onLoadPolls();loadIncludes();loadInputs()}).fadeIn(100)})}function loadInputs(){$("input").each(function(){var a=$(this).attr("type");$(this).addClass(a)})}function onLoadPolls(){$(".onLoadPoll").each(function(){function g(){if(currentUserState==="active"){models(c,d,e,b);setTimeout(g,f)}else if(currentUserState==="recently-inactive"){var a=f*2;models(c,d,e,b);setTimeout(g,a)}else if(currentUserState==="energy-saver"){setTimeout(g,1e3)}}var a="random-"+Math.floor(Math.random()*1e5);$(this).addClass(a);var b="."+a;var c=$(this).attr("data-model");var d=$(this).attr("data-method");var e=$(this).attr("data-send");var f=$(this).attr("data-time");if(f===""){f=1e4}g()})}function onLoadFades(){$(".onLoadFade").each(function(){$(this).delay(2e3).fadeOut(1e3)})}function loadIncludes(){$(".include").each(function(){var a="random-"+Math.floor(Math.random()*1e5);$(this).addClass(a);$(this).removeClass("include");var b="."+a;var c=$(this).attr("data-view");$.get(MINOC("B2")+MINOC("B9"),{url:c},function(a){var c=a.view;var d=a.vars;var e=implode(",",d);if(c.indexOf("!logout")>-1){window.location.href=MINOC("B2")+"/"}else{viewLoad(c,d,e,b)}},"json")})}function onLoads(){$(".onLoad").each(function(){var a="random-"+Math.floor(Math.random()*1e5);$(this).addClass(a);var b="."+a;var c=$(this).attr("data-model");var d=$(this).attr("data-method");var e=$(this).attr("data-send");models(c,d,e,b);$(this).removeClass(".onLoad")})}function models(a,b,c,d){$.ajax({type:"POST",url:MINOC("B2")+MINOC("B8"),data:"type=default&method="+b+"&args="+c+"&model="+a+"&nnc="+MINOC("B7"),success:function(a){if(a.indexOf("!redirect")>-1){var b=a;b=b.replace(/!redirect\s*/,"");window.location.href=MINOC("B2")+"/"+b}else if(a.indexOf("!resredir")>-1){var c=a;var e=c.replace(/.*\[/,"");e=e.replace(/\].*/,"");var f=c.replace(/.*\]/,"");$("body").append('<div class="flresp">'+f+"</div>");$(".flresp").fadeIn().delay(3e3).queue(function(){window.location.href=MINOC("B2")+"/"+e})}else if(a.indexOf("!push")>-1){var b=a;b=b.replace(/!push\s*/,"");History.pushState({state:b},b,b)}else if(a.indexOf("!respush")>-1){var c=a;var e=c.replace(/.*\[/,"");e=e.replace(/\].*/,"");var f=c.replace(/.*\]/,"");$("body").append('<div class="flresp">'+f+"</div>");$(".flresp").fadeIn().delay(3e3).queue(function(){$(this).fadeOut();History.pushState({state:e},e,e)})}else if(a.indexOf("!append")>-1){var c=a;c=c.replace(/!append\s*/,"");if($(d+" .response").is("*")){$(d+" .response").html(c)}else{$(d).append('<div class="response">'+c+"</div>")}}else{$(d).html(a)}}})}function setEnergySaver(){if(MINOC("B6")==="on"){currentUserState="energy-saver";$("#energySaver").fadeIn(1e3)}}function setUserInactive(){currentUserState="recently-inactive"}ENERGIZE("B1",base64_decode(MINOC("LOC")));ENERGIZE("B2",base64_decode(MINOC("RTP")));ENERGIZE("B3",base64_decode(MINOC("AXC")));ENERGIZE("B4",base64_decode(MINOC("RIT")));ENERGIZE("B5",base64_decode(MINOC("EST")));ENERGIZE("B6",base64_decode(MINOC("ESM")));ENERGIZE("B7",base64_decode(MINOC("NNC")));ENERGIZE("B8",base64_decode(MINOC("PTM")));ENERGIZE("B9",base64_decode(MINOC("PTV")));if(MINOC("B3")==="off"){$.ajaxSetup({cache:false})}var currentUserState="active";var inactiveTimer=setTimeout(setUserInactive,MINOC("B4"));var energySaverTimer=setTimeout(setEnergySaver,MINOC("B5"));$("body").bind("mousedown keydown",function(a){clearTimeout(inactiveTimer);clearTimeout(energySaverTimer);$("#energySaver").hide();currentUserState="active";inactiveTimer=setTimeout(setUserInactive,MINOC("B4"));energySaverTimer=setTimeout(setEnergySaver,MINOC("B5"))});if($(".modal").length>0){$(".modal").modal()}$("#view-load").on("submit","form.dbForm",function(){var a="random-"+Math.floor(Math.random()*1e5);$(this).addClass(a);var b="."+a;var c=$(this).attr("data-model");var d=$(this).attr("data-method");var e=$(this).serializeJSON();var f=implode(",",e);models(c,d,f,b);$("input[type=submit]",this).attr("disabled","disabled").delay(2e3).queue(function(){$(this).removeAttr("disabled")});return false});$("body").on("click",".onClick",function(){var a=$(this).attr("data-model");var b=$(this).attr("data-method");var c=$(this).attr("data-send");var d=$(this).attr("data-to");if(d==="this"||d===""){d="random-"+Math.floor(Math.random()*1e5);$(this).addClass(d)}models(a,b,c,d);return false});$("body").on("keyup",".search",function(){var a=$(this).val();if(a.length>2){var b=$(this).attr("data-model");var c=$(this).attr("data-method");var d=a;var e=$(this).attr("data-to");models(b,c,d,e)}});var dbl=0;$("body").on("click",".loadView",function(){var a=$(this).attr("data-view");$.get(MINOC("B2")+MINOC("B9"),{url:a},function(b){var c=b.view;var d=b.title;var e=b.address;var f=b.vars;var g=implode(",",f);if($(this).attr("data-to")){var h=$(this).attr("data-to")}else{var h="#view-load"}if(c.indexOf("!logout")>-1){window.location.href=MINOC("B2")+"/"}else{viewLoad(c,f,g,h)}dbl=1;History.pushState({state:a},d,e);dbl=0},"json");$(".selected").removeClass("selected");$(this).addClass("selected");return false});routeUrl();var goState=function(){if(dbl===0){var a=History.getState();routeState(a.data.state)}};History.Adapter.bind(window,"statechange",goState)
